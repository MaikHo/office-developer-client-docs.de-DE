---
title: Öffnen einer Anlage
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: c0350698-5304-40cd-903d-279471f3c226
description: 'Letzte Änderung: Samstag, 23. Juli 2011'
ms.openlocfilehash: 39da1e02622d81cd12a2d4673b827d49bf418128
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/28/2019
ms.locfileid: "33430623"
---
# <a name="opening-an-attachment"></a><span data-ttu-id="f9da7-103">Öffnen einer Anlage</span><span class="sxs-lookup"><span data-stu-id="f9da7-103">Opening an attachment</span></span>

<span data-ttu-id="f9da7-104">**Gilt für**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="f9da7-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="f9da7-105">Das Öffnen einer Anlage umfasst das Anzeigen der Daten.</span><span class="sxs-lookup"><span data-stu-id="f9da7-105">Opening an attachment involves displaying its data.</span></span> <span data-ttu-id="f9da7-106">Wenn beispielsweise eine Dateianlage geöffnet wird, wird der Inhalt der Datei angezeigt.</span><span class="sxs-lookup"><span data-stu-id="f9da7-106">For example, when a file attachment is opened, the contents of the file are displayed.</span></span> <span data-ttu-id="f9da7-107">Während Nachrichten und Ordner mit ihren Eintrags-IDs geöffnet werden, werden Anlagen mithilfe ihrer Attachment Numbers- **PR_ATTACH_NUM** -Eigenschaften geöffnet.</span><span class="sxs-lookup"><span data-stu-id="f9da7-107">Whereas messages and folders are opened using their entry identifiers, attachments are opened using their attachment numbers — **PR_ATTACH_NUM** properties.</span></span> <span data-ttu-id="f9da7-108">Weitere Informationen finden Sie unter **PR_ATTACH_NUM** ([pidtagattachnumber (](pidtagattachnumber-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="f9da7-108">For more information, see **PR_ATTACH_NUM** ([PidTagAttachNumber](pidtagattachnumber-canonical-property.md)).</span></span> <span data-ttu-id="f9da7-109">Anlagennummern sind über die Attachment-Tabelle einer Nachricht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="f9da7-109">Attachment numbers are available through a message's attachment table.</span></span>
  
### <a name="to-open-all-attachments-in-a-message"></a><span data-ttu-id="f9da7-110">So öffnen Sie alle Anlagen in einer Nachricht</span><span class="sxs-lookup"><span data-stu-id="f9da7-110">To open all attachments in a message</span></span>
  
1. <span data-ttu-id="f9da7-111">Rufen Sie die [IMessage:: GetAttachment](imessage-getattachmenttable.md) Table-Methode der Nachricht auf, um auf Ihre Anlage Tabelle zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-111">Call the message's [IMessage::GetAttachmentTable](imessage-getattachmenttable.md) method to access its attachment table.</span></span> 
    
2. <span data-ttu-id="f9da7-112">Rufen Sie [HrQueryAllRows](hrqueryallrows.md) auf, um alle Zeilen in der Tabelle abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-112">Call [HrQueryAllRows](hrqueryallrows.md) to retrieve all the rows in the table.</span></span> 
    
3. <span data-ttu-id="f9da7-113">Für jede Zeile:</span><span class="sxs-lookup"><span data-stu-id="f9da7-113">For each row:</span></span> 
    
    1. <span data-ttu-id="f9da7-114">Öffnen Sie die Anlage, indem Sie die in der **PR_ATTACH_NUM** -Spalte dargestellte Anlagennummer in einem Aufruf der **IMessage:: openattach** -Methode der Nachricht übergeben.</span><span class="sxs-lookup"><span data-stu-id="f9da7-114">Open the attachment by passing the attachment number represented in the **PR_ATTACH_NUM** column in a call to the message's **IMessage::OpenAttach** method.</span></span> <span data-ttu-id="f9da7-115">Weitere Informationen finden Sie unter [IMessage:: openattach](imessage-openattach.md).</span><span class="sxs-lookup"><span data-stu-id="f9da7-115">For more information, see [IMessage::OpenAttach](imessage-openattach.md).</span></span> <span data-ttu-id="f9da7-116">**Openattach** gibt einen Zeiger auf eine **IAttach** -Implementierung zurück, die Zugriff auf Anlageneigenschaften bietet.</span><span class="sxs-lookup"><span data-stu-id="f9da7-116">**OpenAttach** returns a pointer to an **IAttach** implementation that provides access to attachment properties.</span></span> 
        
    2. <span data-ttu-id="f9da7-117">Rufen Sie die **IMAPIProp::** GetProps-Methode der Anlage auf, um die zugehörige **PR_ATTACH_METHOD** -Eigenschaft abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-117">Call the attachment's **IMAPIProp::GetProps** method to retrieve its **PR_ATTACH_METHOD** property.</span></span> <span data-ttu-id="f9da7-118">Weitere Informationen finden Sie unter [IMAPIProp::](imapiprop-getprops.md) GetProps und **PR_ATTACH_METHOD** ([pidtagattachmethod (](pidtagattachmethod-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="f9da7-118">For more information, see [IMAPIProp::GetProps](imapiprop-getprops.md) and **PR_ATTACH_METHOD** ([PidTagAttachMethod](pidtagattachmethod-canonical-property.md)).</span></span>
        
    3. <span data-ttu-id="f9da7-119">Wenn **PR_ATTACH_METHOD** auf ATTACH_BY_REF_ONLY festgelegt ist, rufen Sie **IMAPIProp::** GetProps auf, um die **PR_ATTACH_PATHNAME** -Eigenschaft abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-119">If **PR_ATTACH_METHOD** is set to ATTACH_BY_REF_ONLY, call **IMAPIProp::GetProps** to retrieve the **PR_ATTACH_PATHNAME** property.</span></span> <span data-ttu-id="f9da7-120">Weitere Informationen finden Sie unter **PR_ATTACH_PATHNAME** ([pidtagattachpathname (](pidtagattachpathname-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="f9da7-120">For more information, see **PR_ATTACH_PATHNAME** ([PidTagAttachPathname](pidtagattachpathname-canonical-property.md)).</span></span>
        
    4. <span data-ttu-id="f9da7-121">Wenn **PR\_ATTACH_METHOD** auf Attach\_BY_VALUE festgelegt ist, rufen Sie **IMAPIProp:: OpenProperty** auf, um die **\_PR-ATTACH_DATA_BIN** -Eigenschaft mit der **IStream** -Schnittstelle zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-121">If **PR\_ATTACH_METHOD** is set to ATTACH\_BY_VALUE, call **IMAPIProp::OpenProperty** to open the **PR\_ATTACH_DATA_BIN** property with the **IStream** interface.</span></span> <span data-ttu-id="f9da7-122">Sehen Sie sich den Beispielcode nach diesem Verfahren an.</span><span class="sxs-lookup"><span data-stu-id="f9da7-122">See the sample code following this procedure.</span></span> <span data-ttu-id="f9da7-123">Weitere Informationen finden Sie unter [IMAPIProp:: OpenProperty](imapiprop-openproperty.md) und **PR_ATTACH_DATA_BIN** ([pidtagattachdatabinary (](pidtagattachdatabinary-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="f9da7-123">For more information, see [IMAPIProp::OpenProperty](imapiprop-openproperty.md) and **PR_ATTACH_DATA_BIN** ([PidTagAttachDataBinary](pidtagattachdatabinary-canonical-property.md)).</span></span>
        
    5. <span data-ttu-id="f9da7-124">Wenn **PR_ATTACH_METHOD** auf ATTACH_OLE festgelegt ist und die Anlage ein OLE 2-Objekt ist:</span><span class="sxs-lookup"><span data-stu-id="f9da7-124">If **PR_ATTACH_METHOD** is set to ATTACH_OLE and the attachment is an OLE 2 object:</span></span> 
        
        1. <span data-ttu-id="f9da7-125">Rufen Sie **IMAPIProp:: OpenProperty** auf, um die **\_PR-ATTACH_DATA_OBJ** -Eigenschaft mit der **IStreamDocfile** -Schnittstelle zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-125">Call **IMAPIProp::OpenProperty** to open the **PR\_ATTACH_DATA_OBJ** property with the **IStreamDocfile** interface.</span></span> <span data-ttu-id="f9da7-126">Versuchen Sie, diese Schnittstelle zu verwenden, da es sich um eine Implementierung von **IStream** handelt, die mit dem geringsten Aufwand mit strukturiertem Speicher kompatibel ist.</span><span class="sxs-lookup"><span data-stu-id="f9da7-126">Attempt to use this interface because it is an implementation of **IStream** guaranteed to work with structured storage with the least amount of overhead.</span></span> <span data-ttu-id="f9da7-127">Weitere Informationen finden Sie unter **PR_ATTACH_DATA_OBJ** ([pidtagattachdataobject (](pidtagattachdataobject-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="f9da7-127">For more information, see **PR_ATTACH_DATA_OBJ** ([PidTagAttachDataObject](pidtagattachdataobject-canonical-property.md)).</span></span>
            
        2. <span data-ttu-id="f9da7-128">Wenn der **OpenProperty** -Aufruf fehlschlägt, rufen Sie ihn erneut auf, um die **PR_ATTACH_DATA_BIN** -Eigenschaft mit der **IStreamDocfile** -Schnittstelle abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-128">If the **OpenProperty** call fails, call it again to retrieve the **PR_ATTACH_DATA_BIN** property with the **IStreamDocfile** interface.</span></span> 
            
        3. <span data-ttu-id="f9da7-129">Wenn dieser zweite **OpenProperty** -Aufruf fehlschlägt, versuchen Sie \*\*\*\* erneut, OpenProperty aufzurufen, um **PR_ATTACH_DATA_OBJ**abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-129">If this second **OpenProperty** call fails, try again to call **OpenProperty** to retrieve **PR_ATTACH_DATA_OBJ**.</span></span> <span data-ttu-id="f9da7-130">Geben Sie jedoch anstelle von **IStreamDocfile**die **IStorage** -Schnittstelle an.</span><span class="sxs-lookup"><span data-stu-id="f9da7-130">However, rather than specifying **IStreamDocfile**, specify the **IStorage** interface.</span></span> 
    
4. <span data-ttu-id="f9da7-131">Wenn **PR_ATTACH_METHOD** auf ATTACH_EMBEDDED_MSG festgelegt ist, ist es nicht ungewöhnlich, dass der Wert von **PR_ATTACH_DATA_OBJ** einen Fehler enthält.</span><span class="sxs-lookup"><span data-stu-id="f9da7-131">If **PR_ATTACH_METHOD** is set to ATTACH_EMBEDDED_MSG, it is not unusual for the value of **PR_ATTACH_DATA_OBJ** to contain an error.</span></span> <span data-ttu-id="f9da7-132">Dies liegt daran, dass Sie und die Tabellen Implementierung keine Möglichkeit haben, den Typ des zurückzugebenden Objekts zu vereinbaren.</span><span class="sxs-lookup"><span data-stu-id="f9da7-132">This is because you and the table implementer have no way to agree on the type of object to return.</span></span> <span data-ttu-id="f9da7-133">Wenn Sie einen Zeiger auf die angefügte Nachricht abrufen möchten, öffnen Sie die Anlage mit **IMessage:: openattach**.</span><span class="sxs-lookup"><span data-stu-id="f9da7-133">To retrieve a pointer to the attached message, open the attachment using **IMessage::OpenAttach**.</span></span> <span data-ttu-id="f9da7-134">Greifen Sie dann auf die Anlagendaten zu, indem Sie die **IMAPIProp:: OpenProperty** -Methode aufrufen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-134">Then access the attachment data by calling its **IMAPIProp::OpenProperty** method.</span></span> <span data-ttu-id="f9da7-135">Weitere Informationen finden Sie unter [IMessage:: openattach](imessage-openattach.md) und [IMAPIProp:: OpenProperty](imapiprop-openproperty.md).</span><span class="sxs-lookup"><span data-stu-id="f9da7-135">For more information, see [IMessage::OpenAttach](imessage-openattach.md) and [IMAPIProp::OpenProperty](imapiprop-openproperty.md).</span></span>
    
<span data-ttu-id="f9da7-136">Sie können anfordern, dass eine Anlage im Lese-/Schreibzugriff oder schreibgeschützt geöffnet wird.</span><span class="sxs-lookup"><span data-stu-id="f9da7-136">You can request that an attachment is opened in read/write or read-only mode.</span></span> <span data-ttu-id="f9da7-137">Schreibgeschützt ist der Standardmodus, und viele Nachrichtenspeicher Anbieter öffnen alle Anlagen in diesem Modus, unabhängig davon, welche Clients eine Anforderung stellen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-137">Read-only is the default mode, and many message store providers open all attachments in this mode regardless of what clients request.</span></span> <span data-ttu-id="f9da7-138">Übergeben Sie das MAPI_BEST_ACCESS-Flag, um anzufordern, dass der Nachrichtenspeicher Anbieter die höchste Zugriffsebene gewährt, und rufen Sie dann die **PR_ACCESS_LEVEL** -Eigenschaft der geöffneten Anlage ab, um die Zugriffsebene zu bestimmen, die tatsächlich erteilt wurde.</span><span class="sxs-lookup"><span data-stu-id="f9da7-138">Pass the MAPI_BEST_ACCESS flag to request that the message store provider grant the highest level of access it can and then retrieve the open attachment's **PR_ACCESS_LEVEL** property to determine the level of access that was actually granted.</span></span> <span data-ttu-id="f9da7-139">Weitere Informationen finden Sie unter **PR_ACCESS_LEVEL** ([pidtagaccesslevel (](pidtagaccesslevel-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="f9da7-139">For more information, see **PR_ACCESS_LEVEL** ([PidTagAccessLevel](pidtagaccesslevel-canonical-property.md)).</span></span>
  
<span data-ttu-id="f9da7-140">Das folgende Beispiel zeigt, wie Sie die Daten in der **PR\_-ATTACH_DATA_BIN** -Eigenschaft einer Anlage öffnen.</span><span class="sxs-lookup"><span data-stu-id="f9da7-140">The following example shows how to open the data in an attachment's **PR\_ATTACH_DATA_BIN** property.</span></span> <span data-ttu-id="f9da7-141">Es weist Zeiger auf zwei Streams zu: einen für die Datei und einen für die Anlage.</span><span class="sxs-lookup"><span data-stu-id="f9da7-141">It allocates pointers to two streams: one for the file and one for the attachment.</span></span> <span data-ttu-id="f9da7-142">Die **OpenStreamOnFile** -Funktion öffnet den Dateistream im schreibgeschützten Modus.</span><span class="sxs-lookup"><span data-stu-id="f9da7-142">The **OpenStreamOnFile** function opens the file stream in read-only mode.</span></span> <span data-ttu-id="f9da7-143">Der Aufruf der **IMAPIProp:: OpenProperty** -Methode der Anlage öffnet den Anlagendatenstrom im Lese-/Schreibzugriff.</span><span class="sxs-lookup"><span data-stu-id="f9da7-143">The call to the attachment's **IMAPIProp::OpenProperty** method opens the attachment stream in read/write mode.</span></span> <span data-ttu-id="f9da7-144">Weitere Informationen finden Sie unter **PR_ATTACH_DATA_BIN**, [OpenStreamOnFile](openstreamonfile.md)und [IMAPIProp:: OpenProperty](imapiprop-openproperty.md).</span><span class="sxs-lookup"><span data-stu-id="f9da7-144">For more information, see **PR_ATTACH_DATA_BIN**, [OpenStreamOnFile](openstreamonfile.md), and [IMAPIProp::OpenProperty](imapiprop-openproperty.md).</span></span> <span data-ttu-id="f9da7-145">Der Code kopiert dann vom Dateistream in den Anlagendatenstrom und gibt beide Streams frei.</span><span class="sxs-lookup"><span data-stu-id="f9da7-145">The code then copies from the file stream to the attachment stream and releases both streams.</span></span>
  
```cpp
LPSTREAM pStreamFile, pStreamAtt;
HRESULT hr;
hr = OpenStreamOnFile (MAPIAllocateBuffer, MAPIFreeBuffer,
                       STGM_READ, "myfile.doc", NULL, &pStreamFile);
if (HR_SUCCEEDED(hr))
{
    // Open the destination stream in the attachment object
    hr = pAttach->OpenProperty (PR_ATTACH_DATA_BIN,
                                &IID_IStream,
                                0,
                                MAPI_MODIFY | MAPI_CREATE,
                                (LPUNKNOWN *)&pStreamAtt);
    if (HR_SUCCEEDED(hr))
    {
        STATSTG StatInfo;
        pStreamFile->Stat (&StatInfo, STATFLAG_NONAME);
        hResult = pStreamFile->CopyTo (pStreamAtt, StatInfo.cbSize,
                                       NULL, NULL);
        pStreamAtt->Release();
    }
    pStreamFile->Release();
}
```


