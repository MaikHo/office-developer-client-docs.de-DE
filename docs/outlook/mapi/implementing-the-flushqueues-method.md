---
title: Implementieren der FlushQueues-Methode
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8719f8aa-a537-4253-b67d-c4d38c40472b
description: 'Letzte �nderung: Montag, 9. M�rz 2015'
ms.openlocfilehash: 1e5c78c71f7fddb04d3517aca0a34efa151ece08
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/23/2019
ms.locfileid: "32310115"
---
# <a name="implementing-the-flushqueues-method"></a><span data-ttu-id="e1570-103">Implementieren der FlushQueues-Methode</span><span class="sxs-lookup"><span data-stu-id="e1570-103">Implementing the FlushQueues Method</span></span>

  
  
<span data-ttu-id="e1570-104">**Gilt für**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="e1570-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="e1570-105">Der MAPI-Spooler verwendet die [IXPLogon:: FlushQueues](ixplogon-flushqueues.md) -Methode zum herunterladen und hochladen ausstehender Nachrichten an einen und von einem Transportanbieter.</span><span class="sxs-lookup"><span data-stu-id="e1570-105">The MAPI spooler uses the [IXPLogon::FlushQueues](ixplogon-flushqueues.md) method to download and upload any pending messages to and from a transport provider.</span></span> <span data-ttu-id="e1570-106">In der Regel werden die Warteschlangen für alle Transportanbieter geleert, die bei der Sitzung angemeldet sind, beginnend mit dem ersten Transportanbieter, der im Abschnitt Transportauftrag des Benutzerprofils festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="e1570-106">Typically, the MAPI spooler will flush the queues for all transport providers that are logged on to the session, starting with the first transport provider as set in the transport order section of the user's profile.</span></span> <span data-ttu-id="e1570-107">Das Leeren von Warteschlangen ist fast immer das Ergebnis einer direkten Anforderung des Benutzers, sodass das Senden und empfangen von Nachrichten während der leeren Warteschlangen synchron mit dem MAPI-Spooler erfolgt.</span><span class="sxs-lookup"><span data-stu-id="e1570-107">Flushing queues is almost always the result of a direct request by the user, so the sending and receiving of messages while queues are flushing is synchronous to the MAPI spooler.</span></span> <span data-ttu-id="e1570-108">Da diese Anrufe synchron sind, sollte der Transportanbieter Sie so schnell wie möglich verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="e1570-108">Because these calls are synchronous, the transport provider should process them as quickly as possible.</span></span> 
  
<span data-ttu-id="e1570-109">Transport Anbieter müssen den **FlushQueues** -Aufruf wie in der folgenden Abfolge von Schritten beschrieben behandeln, um die ordnungsgemäße Nachrichtenverarbeitung zu aktivieren und um zu ermöglichen, dass externe Ressourcen wie Modems von anderen Transportanbietern als Teil der MAPI-Warteschlangen verwendet werden. **FlushQueues** -Vorgang.</span><span class="sxs-lookup"><span data-stu-id="e1570-109">Transport providers must handle the **FlushQueues** call as described in the following sequence of steps to enable proper message processing and to enable external resources such as modems to be used by other transport providers as part of the MAPI spooler's **FlushQueues** operation.</span></span> 
  
|<span data-ttu-id="e1570-110">**Schritt**</span><span class="sxs-lookup"><span data-stu-id="e1570-110">**Step**</span></span>|<span data-ttu-id="e1570-111">**Komponente**</span><span class="sxs-lookup"><span data-stu-id="e1570-111">**Component**</span></span>|<span data-ttu-id="e1570-112">**Implementierung**</span><span class="sxs-lookup"><span data-stu-id="e1570-112">**Implementation**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="e1570-113">1.</span><span class="sxs-lookup"><span data-stu-id="e1570-113">1.</span></span>  <br/> |<span data-ttu-id="e1570-114">MAPI-Spooler</span><span class="sxs-lookup"><span data-stu-id="e1570-114">MAPI spooler</span></span>  <br/> |<span data-ttu-id="e1570-115">Ruft die **FlushQueues** -Methode für den ersten Transportanbieter auf, der in der Transport Reihenfolge des Benutzerprofils aufgeführt ist, und übergibt die angeforderten Flags im _ulFlags_ -Parameter.</span><span class="sxs-lookup"><span data-stu-id="e1570-115">Calls the **FlushQueues** method for the first transport provider listed in the transport order of the user's profile, passing the requested flags in the  _ulFlags_ parameter.</span></span> <span data-ttu-id="e1570-116">**FlushQueues** wird einmal aufgerufen, wenn alle Flags für den gesamten Upload-und Downloadvorgang festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="e1570-116">**FlushQueues** is called once with all flags set for the entire upload and download operation.</span></span>  <br/> |
|<span data-ttu-id="e1570-117">2.</span><span class="sxs-lookup"><span data-stu-id="e1570-117">2.</span></span>  <br/> |<span data-ttu-id="e1570-118">Transport Anbieter</span><span class="sxs-lookup"><span data-stu-id="e1570-118">Transport Provider</span></span>  <br/> |<span data-ttu-id="e1570-119">Vor der Rückgabe vom **FlushQueues** -Aufruf muss eine Reihe von Aufgaben ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="e1570-119">Needs to do a number of things before returning from the **FlushQueues** call.</span></span> <span data-ttu-id="e1570-120">Wenn zuvor übermittelte Nachrichten verzögert werden, sollte die [IMAPISupport:: SpoolerNotify](imapisupport-spoolernotify.md) -Methode mit dem NOTIFY_SENT_DEFERRED-Flag-Satz aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="e1570-120">If previously submitted messages are being deferred, the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method should be called with the NOTIFY_SENT_DEFERRED flag set.</span></span> <span data-ttu-id="e1570-121">Beachten Sie, dass es dem MAPI-Spooler möglich ist, eine Nachricht abzubrechen, die verzögert wurde, bevor der Transportanbieter die Verarbeitung der Nachricht abschließen kann.</span><span class="sxs-lookup"><span data-stu-id="e1570-121">Note that it is possible for the MAPI spooler to cancel a message that has been deferred before the transport provider has a chance to finish processing the message.</span></span>  <br/> <span data-ttu-id="e1570-122">Wenn der Transportanbieter eine externe Ressource wie ein Modem verwendet, sollte die Verbindung mit der externen Ressource hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="e1570-122">If the transport provider uses an external resource such as a modem, the connection to the external resource should be established.</span></span>  <br/> <span data-ttu-id="e1570-123">Das STATUS_OUTBOUND_FLUSH-Bit in der **PR_STATUS_CODE** ([pidtagstatuscode (](pidtagstatuscode-canonical-property.md))-Eigenschaft der Status Zeile des Transportanbieters muss mithilfe der [IMAPISupport:: ModifyStatusRow](imapisupport-modifystatusrow.md) -Methode festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="e1570-123">The STATUS_OUTBOUND_FLUSH bit in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of the transport provider's status row must be set using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span>  <br/> <span data-ttu-id="e1570-124">Der Transportanbieter sollte dann S_OK für den **FlushQueues** -Aufruf zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="e1570-124">The transport provider should then return S_OK for the **FlushQueues** call.</span></span>  <br/> |
|<span data-ttu-id="e1570-125">3.</span><span class="sxs-lookup"><span data-stu-id="e1570-125">3.</span></span>  <br/> |<span data-ttu-id="e1570-126">MAPI-Spooler</span><span class="sxs-lookup"><span data-stu-id="e1570-126">MAPI spooler</span></span>  <br/> |<span data-ttu-id="e1570-127">Überprüft die Statuszeile des Transportanbieters für das STATUS_OUTBOUND_FLUSH-Bit und ruft [IXPLogon:: SubmitMessage](ixplogon-submitmessage.md) für die erste Nachricht in der Warteschlange auf.</span><span class="sxs-lookup"><span data-stu-id="e1570-127">Checks the transport provider's status row for the STATUS_OUTBOUND_FLUSH bit and calls [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) for the first message in the queue.</span></span>  <br/> |
|<span data-ttu-id="e1570-128">4.</span><span class="sxs-lookup"><span data-stu-id="e1570-128">4.</span></span>  <br/> |<span data-ttu-id="e1570-129">Transport Anbieter</span><span class="sxs-lookup"><span data-stu-id="e1570-129">Transport provider</span></span>  <br/> |<span data-ttu-id="e1570-130">Verarbeitet die Nachricht und gibt den **SubmitMessage** -Aufruf zurück.</span><span class="sxs-lookup"><span data-stu-id="e1570-130">Handles the message and returns from the **SubmitMessage** call.</span></span>  <br/> |
|<span data-ttu-id="e1570-131">5.</span><span class="sxs-lookup"><span data-stu-id="e1570-131">5.</span></span>  <br/> |<span data-ttu-id="e1570-132">MAPI-Spooler</span><span class="sxs-lookup"><span data-stu-id="e1570-132">MAPI spooler</span></span>  <br/> |<span data-ttu-id="e1570-133">Wenn der Transportanbieter S_OK von **SubmitMessage**zurückgibt, ruft der MAPI-Spooler [IXPLogon:: EndMessage](ixplogon-endmessage.md) für die Nachricht auf, wie beim regulären Senden von Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="e1570-133">If the transport provider returns S_OK from **SubmitMessage**, the MAPI spooler calls [IXPLogon::EndMessage](ixplogon-endmessage.md) for the message as it does with regular message sending.</span></span>  <br/> <span data-ttu-id="e1570-134">Wenn der Transportanbieter einen anderen Wert als S_OK aus **SubmitMessage**zurückgibt, verarbeitet der MAPI-Spooler den Wert vor dem Aufruf von **EndMessage**oder vor dem Aufruf von **SubmitMessage** .</span><span class="sxs-lookup"><span data-stu-id="e1570-134">If the transport provider returns a value other than S_OK from **SubmitMessage**, the MAPI spooler handles the value appropriately before calling **EndMessage**, or before calling **SubmitMessage** again.</span></span>  <br/> |
|<span data-ttu-id="e1570-135">6.</span><span class="sxs-lookup"><span data-stu-id="e1570-135">6.</span></span>  <br/> |<span data-ttu-id="e1570-136">Transport Anbieter</span><span class="sxs-lookup"><span data-stu-id="e1570-136">Transport provider</span></span>  <br/> |<span data-ttu-id="e1570-137">Gibt von **EndMessage** mit dem Status der Nachrichtenverarbeitung im Parameter _lpulFlags_ zurück.</span><span class="sxs-lookup"><span data-stu-id="e1570-137">Returns from **EndMessage** with its message processing status in the  _lpulFlags_ parameter.</span></span>  <br/> |
|<span data-ttu-id="e1570-138">7.</span><span class="sxs-lookup"><span data-stu-id="e1570-138">7.</span></span>  <br/> |<span data-ttu-id="e1570-139">MAPI-Spooler und Transportanbieter</span><span class="sxs-lookup"><span data-stu-id="e1570-139">MAPI spooler and transport provider</span></span>  <br/> |<span data-ttu-id="e1570-140">Die **SubmitMessage**- -**EndMessage** -Schleife wird fortgesetzt, bis alle Nachrichten in der Warteschlange heruntergeladen wurden.</span><span class="sxs-lookup"><span data-stu-id="e1570-140">The **SubmitMessage**- **EndMessage** loop continues until all messages in the queue have been downloaded.</span></span>  <br/> |
|<span data-ttu-id="e1570-141">8.</span><span class="sxs-lookup"><span data-stu-id="e1570-141">8.</span></span>  <br/> |<span data-ttu-id="e1570-142">MAPI-Spooler</span><span class="sxs-lookup"><span data-stu-id="e1570-142">MAPI spooler</span></span>  <br/> |<span data-ttu-id="e1570-143">Benachrichtigt den Transportanbieter, dass das Herunterladen von Nachrichten beendet wurde, indem die [IXPLogon:: TransportNotify](ixplogon-transportnotify.md) -Methode des Transportanbieters mit dem NOTIFY_END_OUTBOUND_FLUSH-Flagsatz aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e1570-143">Notifies the transport provider that it has finished downloading messages by calling the transport provider's [IXPLogon::TransportNotify](ixplogon-transportnotify.md) method with the NOTIFY_END_OUTBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="e1570-144">9.</span><span class="sxs-lookup"><span data-stu-id="e1570-144">9.</span></span>  <br/> |<span data-ttu-id="e1570-145">Transport Anbieter</span><span class="sxs-lookup"><span data-stu-id="e1570-145">Transport provider</span></span>  <br/> |<span data-ttu-id="e1570-146">Gibt externe Ressourcen frei, die beim Senden ausgehender Nachrichten verwendet werden, damit Sie von anderen Transportanbietern zum leeren der Warteschlangen verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="e1570-146">Frees any external resources used in sending outbound messages so they can be used by other transport providers to flush their queues.</span></span>  <br/> <span data-ttu-id="e1570-147">Das STATUS_INBOUND_FLUSH-Bit in der **PR_STATUS_CODE** -Eigenschaft der Status Zeile des Transportanbieters muss mithilfe von **ModifyStatusRow**festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="e1570-147">The STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of the transport provider's status row must be set using **ModifyStatusRow**.</span></span>  <br/> |
|<span data-ttu-id="e1570-148">10.</span><span class="sxs-lookup"><span data-stu-id="e1570-148">10.</span></span>  <br/> |<span data-ttu-id="e1570-149">MAPI-Spooler</span><span class="sxs-lookup"><span data-stu-id="e1570-149">MAPI spooler</span></span>  <br/> |<span data-ttu-id="e1570-150">Überprüft die Statuszeile des Transportanbieters für das STATUS_INBOUND_FLUSH-Bit und ruft [IXPLogon:: StartMessage](ixplogon-startmessage.md) auf, wenn es festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="e1570-150">Checks the transport provider's status row for the STATUS_INBOUND_FLUSH bit and calls [IXPLogon::StartMessage](ixplogon-startmessage.md) if it is set.</span></span>  <br/> |
|<span data-ttu-id="e1570-151">11.</span><span class="sxs-lookup"><span data-stu-id="e1570-151">11.</span></span>  <br/> |<span data-ttu-id="e1570-152">Transport Anbieter</span><span class="sxs-lookup"><span data-stu-id="e1570-152">Transport provider</span></span>  <br/> |<span data-ttu-id="e1570-153">Verarbeitet die Nachricht und gibt von **StartMessage**zurück.</span><span class="sxs-lookup"><span data-stu-id="e1570-153">Processes the message and returns from **StartMessage**.</span></span> <span data-ttu-id="e1570-154">Wenn der Transportanbieter andere Nachrichten hochladen muss, sollte er **SpoolerNotify** mit dem NOTIFY_NEWMAIL-Flag-Satz aufrufen.</span><span class="sxs-lookup"><span data-stu-id="e1570-154">If the transport provider has other messages to upload, it should call **SpoolerNotify** with the NOTIFY_NEWMAIL flag set.</span></span>  <br/> <span data-ttu-id="e1570-155">Wenn der Transportanbieter keine Nachrichten hochladen kann, sollte er [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) für die Nachricht aufrufen, die der MAPI-Spooler in **StartMessage** übergeben hat, und zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="e1570-155">If the transport provider has no messages to upload, it should call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message the MAPI spooler passed in **StartMessage** and return.</span></span>  <br/> |
|<span data-ttu-id="e1570-156">12.</span><span class="sxs-lookup"><span data-stu-id="e1570-156">12.</span></span>  <br/> |<span data-ttu-id="e1570-157">MAPI-Spooler</span><span class="sxs-lookup"><span data-stu-id="e1570-157">MAPI spooler</span></span>  <br/> |<span data-ttu-id="e1570-158">Der Aufruf von **StartMessage** wird fortgesetzt, bis **SaveChanges** für eine Nachricht aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="e1570-158">Continues calling **StartMessage** until **SaveChanges** is called on a message.</span></span> <span data-ttu-id="e1570-159">Nachdem der Transportanbieter das Hochladen beendet hat, ruft der MAPI-Spooler **TransportNotify** mit dem NOTIFY_END_INBOUND_FLUSH-Kennzeichen Satz auf.</span><span class="sxs-lookup"><span data-stu-id="e1570-159">After the transport provider has finished uploading, the MAPI spooler calls **TransportNotify** with the NOTIFY_END_INBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="e1570-160">13.</span><span class="sxs-lookup"><span data-stu-id="e1570-160">13.</span></span>  <br/> |<span data-ttu-id="e1570-161">Transport Anbieter</span><span class="sxs-lookup"><span data-stu-id="e1570-161">Transport provider</span></span>  <br/> |<span data-ttu-id="e1570-162">Löscht das STATUS_INBOUND_FLUSH-Bit in der **PR_STATUS_CODE** -Eigenschaft seiner Status Zeile mithilfe von **ModifyStatusRow** und gibt alle externen Ressourcen frei, damit Sie von anderen Transportanbietern zur Verfügung stehen.</span><span class="sxs-lookup"><span data-stu-id="e1570-162">Clears the STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of its status row using **ModifyStatusRow** and releases all external resources so they are available for use by other transport providers.</span></span>  <br/> |
|<span data-ttu-id="e1570-163">14.</span><span class="sxs-lookup"><span data-stu-id="e1570-163">14.</span></span>  <br/> |<span data-ttu-id="e1570-164">MAPI-Spooler</span><span class="sxs-lookup"><span data-stu-id="e1570-164">MAPI spooler</span></span>  <br/> |<span data-ttu-id="e1570-165">Ruft **FlushQueues** für den nächsten Transportanbieter auf, der in der Transport Reihenfolge des Benutzerprofils aufgeführt ist.</span><span class="sxs-lookup"><span data-stu-id="e1570-165">Calls **FlushQueues** for the next transport provider listed in the transport order of the user's profile.</span></span>  <br/> |
   
<span data-ttu-id="e1570-166">Wenn eine Clientanwendung [IMAPIStatus:: FlushQueues](imapistatus-flushqueues.md) für das Statusobjekt eines Transportanbieters aufruft, sollte der Transportanbieter das entsprechende Bit in der Statuszeile mit **ModifyStatusRow**festlegen.</span><span class="sxs-lookup"><span data-stu-id="e1570-166">If a client application calls [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) on a transport provider's status object, the transport provider should set the appropriate bit in its status row with **ModifyStatusRow**.</span></span> <span data-ttu-id="e1570-167">Der MAPI-Spooler ruft dann die **IXPLogon:: FlushQueues** -Methode des Transportanbieters an der Bequemlichkeit des MAPI-Spoolers auf.</span><span class="sxs-lookup"><span data-stu-id="e1570-167">The MAPI spooler then calls the transport provider's **IXPLogon::FlushQueues** method at the MAPI spooler's convenience.</span></span> <span data-ttu-id="e1570-168">Wenn die **IXPLogon:: FlushQueues** -Methode des Transportanbieters als Ergebnis eines Aufrufs von **IMAPIStatus:: FlushQueues** einer Clientanwendung aufgerufen wird, wird der Vorgang asynchron für die Clientanwendung ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="e1570-168">When the transport provider's **IXPLogon::FlushQueues** method is called as a result of a client application's **IMAPIStatus::FlushQueues** call, the operation occurs asynchronously to the client application.</span></span> <span data-ttu-id="e1570-169">Andernfalls **IXPLogon:: FlushQueues** arbeitet synchron mit dem MAPI-Spooler.</span><span class="sxs-lookup"><span data-stu-id="e1570-169">Otherwise **IXPLogon::FlushQueues** works synchronously with the MAPI spooler.</span></span> 
  
<span data-ttu-id="e1570-170">Aus Leistungsgründen ruft der MAPI-Spooler nur die **FlushQueues** -Methode eines Transportanbieters auf, wenn die Flags STATUS_INBOUND_FLUSH und STATUS_OUTBOUND_FLUSH in der Status Zeile des Transportanbieters festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="e1570-170">For performance reasons, the MAPI spooler will only call a transport provider's **FlushQueues** method if the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH flags are set in the transport provider's status row.</span></span> <span data-ttu-id="e1570-171">Daher kann ein Transportanbieter den **FlushQueues** -Vorgang jederzeit beenden, indem die Flags STATUS_OUTBOUND_FLUSH und STATUS_INBOUND_FLUSH in der Status Zeile gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="e1570-171">Consequently, a transport provider can stop the **FlushQueues** operation at any time by clearing the STATUS_OUTBOUND_FLUSH and STATUS_INBOUND_FLUSH flags in its status row.</span></span> <span data-ttu-id="e1570-172">Wenn der MAPI-Spooler heruntergefahren wird und den **FlushQueues** -Vorgang beenden muss, wird **TransportNotify** sowohl mit der NOTIFY_END_INBOUND_FLUSH-als auch der NOTIFY_END_OUTBOUND_FLUSH-Flags-Gruppe aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="e1570-172">If the MAPI spooler is shutting down and needs to end the **FlushQueues** operation, it calls **TransportNotify** with both the NOTIFY_END_INBOUND_FLUSH and NOTIFY_END_OUTBOUND_FLUSH flags set.</span></span> <span data-ttu-id="e1570-173">Der Transportanbieter sollte alle externen Ressourcen freigeben und zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="e1570-173">The transport provider should release all external resources and return.</span></span> 
  

