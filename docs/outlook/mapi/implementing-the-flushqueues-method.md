---
title: Implementieren der FlushQueues-Methode
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8719f8aa-a537-4253-b67d-c4d38c40472b
description: 'Letzte �nderung: Montag, 9. M�rz 2015'
ms.openlocfilehash: baafd8b6437f4febaee9420b274c20ba3242cae6
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 06/11/2018
ms.locfileid: "19792586"
---
# <a name="implementing-the-flushqueues-method"></a><span data-ttu-id="b6eba-103">Implementieren der FlushQueues-Methode</span><span class="sxs-lookup"><span data-stu-id="b6eba-103">Implementing the FlushQueues Method</span></span>

  
  
<span data-ttu-id="b6eba-104">**Betrifft**: Outlook</span><span class="sxs-lookup"><span data-stu-id="b6eba-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="b6eba-105">Die MAPI-Warteschlange verwendet die [IXPLogon::FlushQueues](ixplogon-flushqueues.md) Methode herunterladen und Hochladen von ausstehenden Nachrichten zu und von eines Transportdienstes.</span><span class="sxs-lookup"><span data-stu-id="b6eba-105">The MAPI spooler uses the [IXPLogon::FlushQueues](ixplogon-flushqueues.md) method to download and upload any pending messages to and from a transport provider.</span></span> <span data-ttu-id="b6eba-106">In der Regel wird die MAPI-Warteschlange leeren Warteschlangen für alle Transportanbieter, die an der Sitzung angemeldeten beginnend mit der ersten Adressbuchhierarchie wie im Abschnitt Reihenfolge Transport Profil des Benutzers festgelegt.</span><span class="sxs-lookup"><span data-stu-id="b6eba-106">Typically, the MAPI spooler will flush the queues for all transport providers that are logged on to the session, starting with the first transport provider as set in the transport order section of the user's profile.</span></span> <span data-ttu-id="b6eba-107">Das leeren Warteschlangen ist fast immer das Ergebnis einer direkten Anforderung durch den Benutzer, damit das Senden und Empfangen von Nachrichten, während das Warteschlangen leeren werden an die Warteschlange MAPI synchron ist.</span><span class="sxs-lookup"><span data-stu-id="b6eba-107">Flushing queues is almost always the result of a direct request by the user, so the sending and receiving of messages while queues are flushing is synchronous to the MAPI spooler.</span></span> <span data-ttu-id="b6eba-108">Da diese Aufrufe synchron sind, sollte der Adressbuchhierarchie sie so schnell wie möglich verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="b6eba-108">Because these calls are synchronous, the transport provider should process them as quickly as possible.</span></span> 
  
<span data-ttu-id="b6eba-109">Transportanbieter müssen **FlushQueues** Anruf gemäß der Beschreibung in der folgenden Schrittfolge um zum Aktivieren der Verarbeitung der richtige Meldung und die externe Ressourcen wie Modems von anderen Anbietern Transport verwendet werden, als Teil der MAPI-Warteschlange aktivieren behandeln. **FlushQueues** Vorgang.</span><span class="sxs-lookup"><span data-stu-id="b6eba-109">Transport providers must handle the **FlushQueues** call as described in the following sequence of steps to enable proper message processing and to enable external resources such as modems to be used by other transport providers as part of the MAPI spooler's **FlushQueues** operation.</span></span> 
  
|<span data-ttu-id="b6eba-110">**Schritt**</span><span class="sxs-lookup"><span data-stu-id="b6eba-110">**Step**</span></span>|<span data-ttu-id="b6eba-111">**Komponente**</span><span class="sxs-lookup"><span data-stu-id="b6eba-111">**Component**</span></span>|<span data-ttu-id="b6eba-112">**Implementierung**</span><span class="sxs-lookup"><span data-stu-id="b6eba-112">**Implementation**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="b6eba-113">1.</span><span class="sxs-lookup"><span data-stu-id="b6eba-113">1.</span></span>  <br/> |<span data-ttu-id="b6eba-114">MAPI-Warteschlange</span><span class="sxs-lookup"><span data-stu-id="b6eba-114">MAPI spooler</span></span>  <br/> |<span data-ttu-id="b6eba-115">Ruft die **FlushQueues** -Methode für den ersten Transportanbieter in der Reihenfolge Transport die Benutzerprofils aufgeführt, die die angeforderten Kennzeichen im _UlFlags_ -Parameter übergeben.</span><span class="sxs-lookup"><span data-stu-id="b6eba-115">Calls the **FlushQueues** method for the first transport provider listed in the transport order of the user's profile, passing the requested flags in the  _ulFlags_ parameter.</span></span> <span data-ttu-id="b6eba-116">**FlushQueues** wird einmal mit alle Flags für den gesamten Upload und Download-Operation aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="b6eba-116">**FlushQueues** is called once with all flags set for the entire upload and download operation.</span></span>  <br/> |
|<span data-ttu-id="b6eba-117">2.</span><span class="sxs-lookup"><span data-stu-id="b6eba-117">2.</span></span>  <br/> |<span data-ttu-id="b6eba-118">Transportdienst</span><span class="sxs-lookup"><span data-stu-id="b6eba-118">Transport Provider</span></span>  <br/> |<span data-ttu-id="b6eba-119">Eine Reihe von Aufgaben vor der Rückgabe des Aufrufs **FlushQueues** ausführen muss.</span><span class="sxs-lookup"><span data-stu-id="b6eba-119">Needs to do a number of things before returning from the **FlushQueues** call.</span></span> <span data-ttu-id="b6eba-120">Wenn zuvor übermittelt, dass Nachrichten werden zurückgestellt wird, sollte die [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) -Methode mit dem Flag NOTIFY_SENT_DEFERRED aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="b6eba-120">If previously submitted messages are being deferred, the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method should be called with the NOTIFY_SENT_DEFERRED flag set.</span></span> <span data-ttu-id="b6eba-121">Beachten Sie, dass es möglich, dass die MAPI-Warteschlange abbrechen eine Nachricht, die vor der Adressbuchhierarchie zurückgestellte hat die Möglichkeit, die Nachricht verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="b6eba-121">Note that it is possible for the MAPI spooler to cancel a message that has been deferred before the transport provider has a chance to finish processing the message.</span></span>  <br/> <span data-ttu-id="b6eba-122">Wenn der Adressbuchhierarchie eine externe Ressource wie ein Modem verwendet wird, sollte die Verbindung zu externen Ressource hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="b6eba-122">If the transport provider uses an external resource such as a modem, the connection to the external resource should be established.</span></span>  <br/> <span data-ttu-id="b6eba-123">Die STATUS_OUTBOUND_FLUSH bit in der Statuszeile des Transportdienstes-Eigenschaft **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) muss mit der [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) -Methode festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="b6eba-123">The STATUS_OUTBOUND_FLUSH bit in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of the transport provider's status row must be set using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span>  <br/> <span data-ttu-id="b6eba-124">Der Transportdienst sollte dann S_OK für den Anruf **FlushQueues** zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="b6eba-124">The transport provider should then return S_OK for the **FlushQueues** call.</span></span>  <br/> |
|<span data-ttu-id="b6eba-125">3.</span><span class="sxs-lookup"><span data-stu-id="b6eba-125">3.</span></span>  <br/> |<span data-ttu-id="b6eba-126">MAPI-Warteschlange</span><span class="sxs-lookup"><span data-stu-id="b6eba-126">MAPI spooler</span></span>  <br/> |<span data-ttu-id="b6eba-127">Der Adressbuchhierarchie Statuszeile für das Bit STATUS_OUTBOUND_FLUSH überprüft und ruft [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) für die erste Meldung in der Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="b6eba-127">Checks the transport provider's status row for the STATUS_OUTBOUND_FLUSH bit and calls [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) for the first message in the queue.</span></span>  <br/> |
|<span data-ttu-id="b6eba-128">4.</span><span class="sxs-lookup"><span data-stu-id="b6eba-128">4.</span></span>  <br/> |<span data-ttu-id="b6eba-129">Transportdienst</span><span class="sxs-lookup"><span data-stu-id="b6eba-129">Transport provider</span></span>  <br/> |<span data-ttu-id="b6eba-130">Verarbeitet die Nachricht, und gibt den Anruf **SubmitMessage** zurück.</span><span class="sxs-lookup"><span data-stu-id="b6eba-130">Handles the message and returns from the **SubmitMessage** call.</span></span>  <br/> |
|<span data-ttu-id="b6eba-131">5.</span><span class="sxs-lookup"><span data-stu-id="b6eba-131">5.</span></span>  <br/> |<span data-ttu-id="b6eba-132">MAPI-Warteschlange</span><span class="sxs-lookup"><span data-stu-id="b6eba-132">MAPI spooler</span></span>  <br/> |<span data-ttu-id="b6eba-133">Wenn der Adressbuchhierarchie **SubmitMessage**S_OK zurückgibt, ruft die MAPI-Warteschlange [IXPLogon::EndMessage](ixplogon-endmessage.md) für die Nachricht wie bei regulären Nachricht senden.</span><span class="sxs-lookup"><span data-stu-id="b6eba-133">If the transport provider returns S_OK from **SubmitMessage**, the MAPI spooler calls [IXPLogon::EndMessage](ixplogon-endmessage.md) for the message as it does with regular message sending.</span></span>  <br/> <span data-ttu-id="b6eba-134">Wenn der Adressbuchhierarchie **SubmitMessage**einen anderen Wert als S_OK zurückgibt, verarbeitet die MAPI-Warteschlange den Wert entsprechend vor dem Aufruf von **EndMessage**oder vor dem Aufruf von **SubmitMessage** erneut.</span><span class="sxs-lookup"><span data-stu-id="b6eba-134">If the transport provider returns a value other than S_OK from **SubmitMessage**, the MAPI spooler handles the value appropriately before calling **EndMessage**, or before calling **SubmitMessage** again.</span></span>  <br/> |
|<span data-ttu-id="b6eba-135">6.</span><span class="sxs-lookup"><span data-stu-id="b6eba-135">6.</span></span>  <br/> |<span data-ttu-id="b6eba-136">Transportdienst</span><span class="sxs-lookup"><span data-stu-id="b6eba-136">Transport provider</span></span>  <br/> |<span data-ttu-id="b6eba-137">Wird von **EndMessage** mit dessen Status im _LpulFlags_ -Parameter die Verarbeitung der Nachricht.</span><span class="sxs-lookup"><span data-stu-id="b6eba-137">Returns from **EndMessage** with its message processing status in the  _lpulFlags_ parameter.</span></span>  <br/> |
|<span data-ttu-id="b6eba-138">7.</span><span class="sxs-lookup"><span data-stu-id="b6eba-138">7.</span></span>  <br/> |<span data-ttu-id="b6eba-139">MAPI-Warteschlange und Transport-Anbieter</span><span class="sxs-lookup"><span data-stu-id="b6eba-139">MAPI spooler and transport provider</span></span>  <br/> |<span data-ttu-id="b6eba-140">Die **SubmitMessage**- **EndMessage** Schleife wird fortgesetzt, bis alle Nachrichten in der Warteschlange übertragen worden sind.</span><span class="sxs-lookup"><span data-stu-id="b6eba-140">The **SubmitMessage**- **EndMessage** loop continues until all messages in the queue have been downloaded.</span></span>  <br/> |
|<span data-ttu-id="b6eba-141">8.</span><span class="sxs-lookup"><span data-stu-id="b6eba-141">8.</span></span>  <br/> |<span data-ttu-id="b6eba-142">MAPI-Warteschlange</span><span class="sxs-lookup"><span data-stu-id="b6eba-142">MAPI spooler</span></span>  <br/> |<span data-ttu-id="b6eba-143">Der Adressbuchhierarchie benachrichtigt, dass Nachrichten durch Aufrufen der Adressbuchhierarchie [IXPLogon::TransportNotify](ixplogon-transportnotify.md) -Methode mit dem Flag NOTIFY_END_OUTBOUND_FLUSH Download abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="b6eba-143">Notifies the transport provider that it has finished downloading messages by calling the transport provider's [IXPLogon::TransportNotify](ixplogon-transportnotify.md) method with the NOTIFY_END_OUTBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="b6eba-144">9.</span><span class="sxs-lookup"><span data-stu-id="b6eba-144">9.</span></span>  <br/> |<span data-ttu-id="b6eba-145">Transportdienst</span><span class="sxs-lookup"><span data-stu-id="b6eba-145">Transport provider</span></span>  <br/> |<span data-ttu-id="b6eba-146">Gibt alle ausgehende Nachrichten senden, damit sie von anderen Anbietern Transport verwendet werden können, um ihre Warteschlangen zu leeren verwendeten externen Ressourcen frei.</span><span class="sxs-lookup"><span data-stu-id="b6eba-146">Frees any external resources used in sending outbound messages so they can be used by other transport providers to flush their queues.</span></span>  <br/> <span data-ttu-id="b6eba-147">Das bit in der Statuszeile des Transportdienstes-Eigenschaft **PR_STATUS_CODE** STATUS_INBOUND_FLUSH müssen mit **ModifyStatusRow**festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="b6eba-147">The STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of the transport provider's status row must be set using **ModifyStatusRow**.</span></span>  <br/> |
|<span data-ttu-id="b6eba-148">10.</span><span class="sxs-lookup"><span data-stu-id="b6eba-148">10.</span></span>  <br/> |<span data-ttu-id="b6eba-149">MAPI-Warteschlange</span><span class="sxs-lookup"><span data-stu-id="b6eba-149">MAPI spooler</span></span>  <br/> |<span data-ttu-id="b6eba-150">Der Adressbuchhierarchie Statuszeile für das Bit STATUS_INBOUND_FLUSH überprüft und [IXPLogon::StartMessage](ixplogon-startmessage.md) aufgerufen, wenn sie festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="b6eba-150">Checks the transport provider's status row for the STATUS_INBOUND_FLUSH bit and calls [IXPLogon::StartMessage](ixplogon-startmessage.md) if it is set.</span></span>  <br/> |
|<span data-ttu-id="b6eba-151">11.</span><span class="sxs-lookup"><span data-stu-id="b6eba-151">11.</span></span>  <br/> |<span data-ttu-id="b6eba-152">Transportdienst</span><span class="sxs-lookup"><span data-stu-id="b6eba-152">Transport provider</span></span>  <br/> |<span data-ttu-id="b6eba-153">Verarbeitet die Nachricht, und gibt **StartMessage**zurück.</span><span class="sxs-lookup"><span data-stu-id="b6eba-153">Processes the message and returns from **StartMessage**.</span></span> <span data-ttu-id="b6eba-154">Weist der Adressbuchhierarchie anderen Nachrichten hochladen, muss sie mit dem Flag NOTIFY_NEWMAIL **SpoolerNotify** aufrufen.</span><span class="sxs-lookup"><span data-stu-id="b6eba-154">If the transport provider has other messages to upload, it should call **SpoolerNotify** with the NOTIFY_NEWMAIL flag set.</span></span>  <br/> <span data-ttu-id="b6eba-155">Weist der Adressbuchhierarchie keine Nachrichten hochladen, muss sie [IMAPIProp::SaveChanges](imapiprop-savechanges.md) aufrufen, für die Nachricht die MAPI-Warteschlange in **StartMessage** übergeben, und zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="b6eba-155">If the transport provider has no messages to upload, it should call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message the MAPI spooler passed in **StartMessage** and return.</span></span>  <br/> |
|<span data-ttu-id="b6eba-156">12.</span><span class="sxs-lookup"><span data-stu-id="b6eba-156">12.</span></span>  <br/> |<span data-ttu-id="b6eba-157">MAPI-Warteschlange</span><span class="sxs-lookup"><span data-stu-id="b6eba-157">MAPI spooler</span></span>  <br/> |<span data-ttu-id="b6eba-158">Ruft weiterhin **StartMessage** bis auf eine Nachricht **SaveChanges** aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="b6eba-158">Continues calling **StartMessage** until **SaveChanges** is called on a message.</span></span> <span data-ttu-id="b6eba-159">Nachdem der Adressbuchhierarchie hochladen beendet wurde, ruft die MAPI-Warteschlange **TransportNotify** mit der NOTIFY_END_INBOUND_FLUSH-Flag.</span><span class="sxs-lookup"><span data-stu-id="b6eba-159">After the transport provider has finished uploading, the MAPI spooler calls **TransportNotify** with the NOTIFY_END_INBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="b6eba-160">13.</span><span class="sxs-lookup"><span data-stu-id="b6eba-160">13.</span></span>  <br/> |<span data-ttu-id="b6eba-161">Transportdienst</span><span class="sxs-lookup"><span data-stu-id="b6eba-161">Transport provider</span></span>  <br/> |<span data-ttu-id="b6eba-162">Löscht das bit in der **PR_STATUS_CODE** -Eigenschaft der Statuszeile mit **ModifyStatusRow** und Versionen verwenden Sie alle externe Ressourcen, damit sie für verfügbar sind von anderen Anbietern Transport STATUS_INBOUND_FLUSH.</span><span class="sxs-lookup"><span data-stu-id="b6eba-162">Clears the STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of its status row using **ModifyStatusRow** and releases all external resources so they are available for use by other transport providers.</span></span>  <br/> |
|<span data-ttu-id="b6eba-163">14.</span><span class="sxs-lookup"><span data-stu-id="b6eba-163">14.</span></span>  <br/> |<span data-ttu-id="b6eba-164">MAPI-Warteschlange</span><span class="sxs-lookup"><span data-stu-id="b6eba-164">MAPI spooler</span></span>  <br/> |<span data-ttu-id="b6eba-165">Ruft **FlushQueues** für den nächsten Transportanbieter in der Reihenfolge Transport, der das Profil des Benutzers aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="b6eba-165">Calls **FlushQueues** for the next transport provider listed in the transport order of the user's profile.</span></span>  <br/> |
   
<span data-ttu-id="b6eba-166">Wenn eine Client-Anwendung anrufen [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) eines Transportdienstes Status Objekt sollten der Adressbuchhierarchie das entsprechende Bit in der Statuszeile mit **ModifyStatusRow**festlegen.</span><span class="sxs-lookup"><span data-stu-id="b6eba-166">If a client application calls [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) on a transport provider's status object, the transport provider should set the appropriate bit in its status row with **ModifyStatusRow**.</span></span> <span data-ttu-id="b6eba-167">Die MAPI-Warteschlange ruft dann der Adressbuchhierarchie **IXPLogon::FlushQueues** -Methode die MAPI-Warteschlange Ermessen.</span><span class="sxs-lookup"><span data-stu-id="b6eba-167">The MAPI spooler then calls the transport provider's **IXPLogon::FlushQueues** method at the MAPI spooler's convenience.</span></span> <span data-ttu-id="b6eba-168">Wenn als Ergebnis einer Clientanwendung **IMAPIStatus::FlushQueues** Anruf, der Adressbuchhierarchie **IXPLogon::FlushQueues** -Methode aufgerufen wird die Verarbeitung erfolgt asynchron an die Clientanwendung.</span><span class="sxs-lookup"><span data-stu-id="b6eba-168">When the transport provider's **IXPLogon::FlushQueues** method is called as a result of a client application's **IMAPIStatus::FlushQueues** call, the operation occurs asynchronously to the client application.</span></span> <span data-ttu-id="b6eba-169">Andernfalls funktioniert **IXPLogon::FlushQueues** synchron mit der MAPI-Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="b6eba-169">Otherwise **IXPLogon::FlushQueues** works synchronously with the MAPI spooler.</span></span> 
  
<span data-ttu-id="b6eba-170">Aus Leistungsgründen wird die MAPI-Warteschlange nur eines Transportdienstes **FlushQueues** -Methode aufrufen, wenn die Flags STATUS_INBOUND_FLUSH und STATUS_OUTBOUND_FLUSH in der Adressbuchhierarchie Statuszeile festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="b6eba-170">For performance reasons, the MAPI spooler will only call a transport provider's **FlushQueues** method if the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH flags are set in the transport provider's status row.</span></span> <span data-ttu-id="b6eba-171">Daher kann ein Transportdienstes den **FlushQueues** Vorgang können Sie jederzeit durch die Flags STATUS_OUTBOUND_FLUSH und STATUS_INBOUND_FLUSH in der Statuszeile clearing beenden.</span><span class="sxs-lookup"><span data-stu-id="b6eba-171">Consequently, a transport provider can stop the **FlushQueues** operation at any time by clearing the STATUS_OUTBOUND_FLUSH and STATUS_INBOUND_FLUSH flags in its status row.</span></span> <span data-ttu-id="b6eba-172">Wenn die MAPI-Warteschlange heruntergefahren wird und muss den **FlushQueues** Vorgang zu beenden, wird mit der NOTIFY_END_INBOUND_FLUSH und die NOTIFY_END_OUTBOUND_FLUSH Flags **TransportNotify** .</span><span class="sxs-lookup"><span data-stu-id="b6eba-172">If the MAPI spooler is shutting down and needs to end the **FlushQueues** operation, it calls **TransportNotify** with both the NOTIFY_END_INBOUND_FLUSH and NOTIFY_END_OUTBOUND_FLUSH flags set.</span></span> <span data-ttu-id="b6eba-173">Der Transportdienst sollte alle externe Ressourcen freizugeben und zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="b6eba-173">The transport provider should release all external resources and return.</span></span> 
  

